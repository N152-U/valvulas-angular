(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"8c62":function(e,t,o){"use strict";o.r(t),o.d(t,"ManageRolesModule",function(){return Ce});var n=o("3Pt+"),r=o("tyNb"),i=o("UTcu"),a=o("PSD3"),s=o.n(a),l=o("fXoL"),c=o("6doT"),b=o("qSrz"),d=o("ofXK"),u=o("5EWq"),m=o("7zfz"),p=o("rEr+"),h=o("jIHw"),f=o("7kUa");const g=function(){return["new-role"]};function v(e,t){1&e&&l.Lb(0,"p-button",14),2&e&&l.hc("routerLink",l.jc(1,g))}const y=function(){return["home"]};function P(e,t){1&e&&l.Lb(0,"p-button",15),2&e&&l.hc("routerLink",l.jc(1,y))}function C(e,t){if(1&e){const e=l.Rb();l.Qb(0,"tr"),l.Qb(1,"th",16),l.Fc(2,"Role "),l.Lb(3,"p-sortIcon"),l.Pb(),l.Qb(4,"th"),l.Fc(5,"Status"),l.Pb(),l.Qb(6,"th"),l.Fc(7,"Acciones"),l.Pb(),l.Pb(),l.Qb(8,"tr"),l.Qb(9,"th"),l.Qb(10,"input",17),l.Xb("input",function(t){return l.vc(e),l.bc(),l.tc(10).filter(t.target.value,"role","contains")}),l.Pb(),l.Pb(),l.Lb(11,"th"),l.Pb()}if(2&e){l.bc();const e=l.tc(10);let t=null;l.yb(10),l.hc("value",null==(t=e.filters.role)?null:t.value)}}const w=function(e){return["edit-role",e]};function Q(e,t){if(1&e){const e=l.Rb();l.Qb(0,"tr",18),l.Qb(1,"td"),l.Fc(2),l.Pb(),l.Qb(3,"td"),l.Qb(4,"span"),l.Fc(5),l.Pb(),l.Pb(),l.Qb(6,"td"),l.Qb(7,"button",19),l.Lb(8,"i",20),l.Pb(),l.Fc(9," \xa0 "),l.Qb(10,"button",21),l.Xb("click",function(){l.vc(e);const o=t.$implicit,n=t.$implicit;return l.bc(2).deleteRole(o,n)}),l.Lb(11,"i",22),l.Pb(),l.Pb(),l.Pb()}if(2&e){const e=t.$implicit;l.hc("pSelectableRow",e),l.yb(2),l.Gc(e.role),l.yb(2),l.Bb("badge ",1==e.status?"bg-success":"bg-warning",""),l.yb(1),l.Gc(1==e.status?"ACTIVO":"BLOQUEADO"),l.yb(2),l.hc("routerLink",l.kc(7,w,e.hash))}}function I(e,t){}function x(e,t){}function N(e,t){1&e&&(l.Qb(0,"div",23),l.Qb(1,"h4",24),l.Fc(2,"No hay registros"),l.Pb(),l.Qb(3,"p"),l.Lb(4,"i",25),l.Pb(),l.Pb())}function F(e,t){1&e&&(l.Qb(0,"div",26),l.Qb(1,"h4",24),l.Fc(2,"Cargando"),l.Pb(),l.Qb(3,"p"),l.Lb(4,"i",27),l.Pb(),l.Qb(5,"p",28),l.Fc(6,"Espere por favor"),l.Pb(),l.Pb())}const R=function(){return{width:"100%"}},k=function(){return[5,10,25,50]};function D(e,t){if(1&e&&(l.Qb(0,"div"),l.Qb(1,"div",1),l.Qb(2,"header"),l.Qb(3,"h1",2),l.Fc(4,"Administraci\xf3n de roles"),l.Pb(),l.Pb(),l.Qb(5,"p-toolbar",3),l.Dc(6,v,1,2,"ng-template",4),l.Dc(7,P,1,2,"ng-template",5),l.Pb(),l.Lb(8,"br"),l.Qb(9,"p-table",6,7),l.Dc(11,C,12,1,"ng-template",8),l.Dc(12,Q,12,9,"ng-template",9),l.Dc(13,I,0,0,"ng-template",10),l.Dc(14,x,0,0,"ng-template",11),l.Pb(),l.Pb(),l.Dc(15,N,5,0,"div",12),l.Dc(16,F,7,0,"div",13),l.Pb()),2&e){const e=l.bc();l.yb(9),l.Ac(l.jc(10,R)),l.hc("value",e.roles)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("scrollable",!0)("rowsPerPageOptions",l.jc(11,k)),l.yb(6),l.hc("ngIf",!e.cargando&&0===e.roles.length),l.yb(1),l.hc("ngIf",e.cargando)}}let L=(()=>{class e{constructor(e,t,n){this.api=e,this.router=t,this.ps=n,this.roles=[],this.cargando=!1,this.first=0,this.rows=10,this.hash=o("1EKS"),this.permissions$=this.ps.permissions$}ngOnInit(){this.cargando=!0,this.api.GetAllRoles().subscribe(e=>{this.roles=e.payload,this.cargando=!1})}deleteRole(e,t){s.a.fire({title:`\xbfEst\xe1 seguro que desea borrar el rol ${e.role}?`,icon:"question",showDenyButton:!0,confirmButtonText:"Confirmar",denyButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&(this.roles.splice(t,1),this.api.DeleteRole(e.hash).subscribe(e=>{s.a.fire({position:"center",icon:"success",title:"Rol eliminado",showConfirmButton:!1}),setTimeout(()=>{window.location.reload()},1300)}))})}next(){this.first=this.first+this.rows}prev(){this.first=this.first-this.rows}reset(){this.first=0}isLastPage(){return!this.roles||this.first===this.roles.length-this.rows}isFirstPage(){return!this.roles||0===this.first}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(c.a),l.Kb(r.b),l.Kb(b.b))},e.\u0275cmp=l.Eb({type:e,selectors:[["app-manage-roles"]],decls:2,vars:1,consts:[[4,"ngIf"],[1,"card","centrar"],[1,"text-center","text-black"],["styleClass","p-mb-4"],["pTemplate","left"],["pTemplate","right"],["styleClass","p-datatable-sm p-datatable-striped p-datatable-responsive-demo","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","dataKey","id","scrollHeight","500px",3,"value","paginator","rows","showCurrentPageReport","scrollable","rowsPerPageOptions"],["dt1",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","paginatorleft"],["pTemplate","paginatorright"],["class","alert alert-warning text-center mt-3 animated fadeIn faster",4,"ngIf"],["class","alert alert-info text-center mt-3 animated fadeIn faster",4,"ngIf"],["styleClass","p-button-sm p-button-success","label","Nuevo Registro","icon","pi pi-plus",3,"routerLink"],["styleClass","p-button-sm","label","Inicio",3,"routerLink"],["pSortableColumn","role"],["pInputText","","type","text","placeholder","Busqueda por role",1,"p-column-filter","p-inputtext-sm",3,"value","input"],[3,"pSelectableRow"],[1,"btn","btn-primary","btnEditar",3,"routerLink"],[1,"fa","fa-pen"],[1,"btn","btn-danger",3,"click"],[1,"fa","fa-trash"],[1,"alert","alert-warning","text-center","mt-3","animated","fadeIn","faster"],[1,"alert-heading"],[1,"fa","fa-exclamation","fa-2x"],[1,"alert","alert-info","text-center","mt-3","animated","fadeIn","faster"],[1,"fa","fa-sync-alt","fa-spin","fa-2x"],[1,"mb-0"]],template:function(e,t){1&e&&(l.Lb(0,"router-outlet"),l.Dc(1,D,17,12,"div",0)),2&e&&(l.yb(1),l.hc("ngIf","/managment/manage-roles"==t.router.url))},directives:[r.g,d.l,u.a,m.i,p.d,h.a,r.c,p.c,p.b,f.a,p.a],styles:["h3[_ngcontent-%COMP%]{color:#56ba6a}th[_ngcontent-%COMP%]{text-align:center;align-items:center;align-content:center!important}.centrar[_ngcontent-%COMP%]{width:90%;margin-left:auto;margin-right:auto;margin-top:20px}#deleteColumn[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center}table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > td.col-button[_ngcontent-%COMP%]{text-align:center}.col-button[_ngcontent-%COMP%]{width:10%}.col-button[_ngcontent-%COMP%], .my-center-text[_ngcontent-%COMP%], td.col-button[_ngcontent-%COMP%]{text-align:center}@media screen and (max-width:40rem){[_nghost-%COMP%]     .p-datatable.p-datatable-responsive-demo .p-datatable-tfoot>tr>td, [_nghost-%COMP%]     .p-datatable.p-datatable-responsive-demo .p-datatable-thead>tr>th{display:none!important}[_nghost-%COMP%]     .p-datatable.p-datatable-responsive-demo .p-datatable-tbody>tr>td{text-align:left;display:block;width:100%;float:left;clear:left;border:0}[_nghost-%COMP%]     .p-datatable.p-datatable-responsive-demo .p-datatable-tbody>tr>td .p-column-title{padding:.4rem;min-width:30%;display:inline-block;margin:-.4em 1em -.4em -.4rem;font-weight:700}[_nghost-%COMP%]     .p-datatable.p-datatable-responsive-demo .p-datatable-tbody>tr>td:last-child{border-bottom:1px solid var(--surface-d)}}"]}),e})();class O{}var G=o("QIUk"),_=o("Ji6n");function B(e,t){1&e&&(l.Qb(0,"div"),l.Fc(1," El campo es obligatorio "),l.Pb())}function M(e,t){1&e&&(l.Qb(0,"div"),l.Fc(1," El nombre debe ser de al menos 2 caracteres "),l.Pb())}function T(e,t){if(1&e&&(l.Qb(0,"div",13),l.Dc(1,B,2,0,"div",14),l.Dc(2,M,2,0,"div",14),l.Pb()),2&e){const e=l.bc();l.yb(1),l.hc("ngIf",e.roleName.errors.required),l.yb(1),l.hc("ngIf",e.roleName.errors.minlength)}}function E(e,t){if(1&e){const e=l.Rb();l.Qb(0,"div",15),l.Qb(1,"p-checkbox",16),l.Xb("onChange",function(o){l.vc(e);const n=t.$implicit;return l.bc().CheckboxArray(n.id,o.checked,"permissionId")}),l.Pb(),l.Qb(2,"label",17),l.Fc(3),l.Pb(),l.Pb()}if(2&e){const e=t.$implicit;l.yb(1),l.hc("inputId",e.id)("value",e.id),l.yb(1),l.hc("for",e.id),l.yb(1),l.Gc(e.description)}}const S=function(e,t){return{"is-invalid":e,"is-valid":t}},j=function(){return{"margin-left":".4em"}},A=function(){return["/managment/manage-roles"]};let K=(()=>{class e{constructor(e,t,o){this.api=e,this.router=t,this.formBuilder=o,this.newRole=new O,this.permissions=[]}ngOnInit(){this.api.GetPermissions().subscribe(e=>{this.permissions=e}),this.aFormGroup=this.formBuilder.group({roleName:["",[n.r.required,n.r.minLength(2)]],permissionId:this.formBuilder.array([],[n.r.required,n.r.minLength(1)])})}roleChanged(){}CheckboxArray(e,t,o){const r=this.aFormGroup.get(o);if(t)r.push(new n.d(e));else{const t=r.controls.findIndex(t=>t.value==e);r.removeAt(t)}}save(){s.a.fire({title:"\xbfDesea guardar el nuevo rol?",icon:"question",showDenyButton:!0,confirmButtonText:"Confirmar",denyButtonText:"Cancelar"}).then(e=>{e.isConfirmed?this.api.CreateRole(this.aFormGroup.value).subscribe(e=>{s.a.fire({position:"center",icon:"success",title:"Rol guardado",showConfirmButton:!1}),this.router.navigate(["/managment/manage-roles"]),setTimeout(()=>{window.location.reload()},1500)},e=>{s.a.fire({icon:"error",title:e.error.validation.body.message,showConfirmButton:!1}).then(function(){})}):e.isDenied&&s.a.fire("Rol no guardado","","info")})}get roleName(){return this.aFormGroup.get("roleName")}get permissionId(){return this.aFormGroup.get("permissionId")}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(c.a),l.Kb(r.b),l.Kb(n.c))},e.\u0275cmp=l.Eb({type:e,selectors:[["app-new-role"]],decls:20,vars:14,consts:[[1,"d-flex","justify-content-center","cardF"],["header","Nuevo registro","styleClass","p-card-shadow"],["novalidate","",1,"needs-validation","center",3,"formGroup","ngSubmit"],["f","ngForm"],[1,"form-row"],[1,"col-md-12"],[1,"input-group"],["id","role","name","role","type","text","formControlName","roleName","placeholder","Nombre del role",1,"form-control",3,"onChange"],["class","invalid-feedback",4,"ngIf"],[1,"row","m-3"],["formArrayName","permissionId","class","p-field-checkbox col-md-12 ",4,"ngFor","ngForOf"],["type","submit ","label","Guardar ","icon","pi pi-check ","styleClass","p-button-sm p-button-success ",3,"disabled"],["label","Cancelar ","icon","pi pi-times ","styleClass","p-button-sm p-button-danger ",3,"routerLink"],[1,"invalid-feedback"],[4,"ngIf"],["formArrayName","permissionId",1,"p-field-checkbox","col-md-12"],[3,"inputId","value","onChange"],[3,"for"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"p-card",1),l.Qb(2,"form",2,3),l.Xb("ngSubmit",function(){return t.save()}),l.Qb(4,"div",4),l.Qb(5,"div",5),l.Qb(6,"label"),l.Fc(7,"Nombre del role*"),l.Pb(),l.Qb(8,"div",6),l.Qb(9,"input",7),l.Xb("onChange",function(){return t.roleChanged()}),l.Pb(),l.Dc(10,T,3,2,"div",8),l.Pb(),l.Lb(11,"br"),l.Qb(12,"div",9),l.Fc(13," Seleccione las opciones sobre las que tiene permisos "),l.Qb(14,"b"),l.Fc(15,"(al menos una)*"),l.Pb(),l.Pb(),l.Pb(),l.Dc(16,E,4,4,"div",10),l.Pb(),l.Lb(17,"br"),l.Lb(18,"p-button",11),l.Lb(19,"p-button",12),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.yb(2),l.hc("formGroup",t.aFormGroup),l.yb(7),l.Ab(l.lc(9,S,t.roleName.invalid&&(t.roleName.dirty||t.roleName.touched||t.roleName.errors.minlength),t.roleName.valid)),l.yb(1),l.hc("ngIf",t.roleName.invalid&&(t.roleName.dirty||t.roleName.touched)),l.yb(6),l.hc("ngForOf",t.permissions),l.yb(2),l.hc("disabled",!t.aFormGroup.valid),l.yb(1),l.Ac(l.jc(12,j)),l.hc("routerLink",l.jc(13,A)))},directives:[G.a,n.s,n.n,n.g,n.a,n.m,n.e,d.l,d.k,h.a,r.c,n.b,_.a],styles:[".cardF[_ngcontent-%COMP%]{padding:5%}"]}),e})();var q=o("SxV6");function U(e,t){1&e&&(l.Qb(0,"div"),l.Fc(1," El campo es obligatorio "),l.Pb())}function X(e,t){1&e&&(l.Qb(0,"div"),l.Fc(1," El nombre debe ser de al menos 2 caracteres "),l.Pb())}function $(e,t){if(1&e&&(l.Qb(0,"div",13),l.Dc(1,U,2,0,"div",14),l.Dc(2,X,2,0,"div",14),l.Pb()),2&e){const e=l.bc();l.yb(1),l.hc("ngIf",e.roleName.errors.required),l.yb(1),l.hc("ngIf",e.roleName.errors.minlength)}}function z(e,t){if(1&e){const e=l.Rb();l.Qb(0,"div",15),l.Qb(1,"p-checkbox",16),l.Xb("onChange",function(t){return l.vc(e),l.bc().onCheckboxChange(t)}),l.Pb(),l.Qb(2,"label",17),l.Fc(3),l.Pb(),l.Pb()}if(2&e){const e=t.$implicit;l.yb(1),l.hc("formControlName",e.value.id)("value",e.value.id)("inputId",e.value.id),l.yb(1),l.hc("for",e.value.id),l.yb(1),l.Gc(e.value.description)}}const V=function(e,t){return{"is-invalid":e,"is-valid":t}},H=function(){return{"margin-left":".4em"}},J=function(){return["/managment/manage-roles"]},W=[{path:"",component:L,children:[{path:"new-role",component:K,canActivate:[i.a]},{path:"edit-role/:hash",component:(()=>{class e{constructor(e,t,n,r,i){this.api=e,this.route=t,this.router=n,this._formBuilder=r,this.cd=i,this.permissions=[],this.loading=!1,this.checked=!1,this.hash=o("1EKS"),this.showLinkedRisksOnly=!0,this.condition=!0}ngOnInit(){this.hash=this.route.snapshot.params.hash,this.formRoleDetailGroup=this._formBuilder.group({roleName:["",[n.r.required,n.r.minLength(2)]],permissionId:this._formBuilder.group([])}),this.api.GetIdRolePermission(this.hash).subscribe(e=>{this.permissionsId=e,this.api.GetPermissions().subscribe(e=>{this.permissions=e;const t=this.permissions.map(e=>e.id),o=this.formRoleDetailGroup.get("permissionId");this.permissions.forEach((e,r)=>{Object(l.U)()&&console.log("permissions_role",this.permissionsId,"id_foreach",t[r],"permissions_includes",this.permissionsId.indexOf(t[r])>=0,"nara",String(e.id)),o.addControl(String(e.id),new n.d(this.permissionsId.indexOf(t[r])>=0))}),Object(l.U)()&&console.log("formdata",this.formRoleDetailGroup)})}),this.api.GetIdRole(this.hash).subscribe(e=>this.formRoleDetailGroup.patchValue(e[0])),this.formRoleDetailGroup.valueChanges.subscribe(e=>this.onFormformRoleDetailGroupChange(e))}onCheckboxChange(e){Object(l.U)()&&console.log(this.formRoleDetailGroup.get("permissionId"))}onFormformRoleDetailGroupChange(e){Object(l.U)()&&console.log("Data",e)}UpdateRole(){s.a.fire({title:"\xbfDesea guardar los cambios?",icon:"question",showDenyButton:!0,confirmButtonText:"Confirmar",denyButtonText:"Cancelar"}).then(e=>{e.isConfirmed?this.api.UpdateRole(this.hash,this.formRoleDetailGroup.value).pipe(Object(q.a)()).subscribe(()=>{s.a.fire({position:"center",icon:"success",title:"Rol actualizado",showConfirmButton:!1}),this.router.navigate(["/managment/manage-roles"]),setTimeout(()=>{window.location.reload()},1300)},e=>{s.a.fire({icon:"error",title:e.error.validation.body.message,showConfirmButton:!1}).then(function(){})}):e.isDenied&&s.a.fire("Rol no actualizado","","info")})}get roleName(){return this.formRoleDetailGroup.get("roleName")}get permissionId(){return this.formRoleDetailGroup.get("permissionId")}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(c.a),l.Kb(r.a),l.Kb(r.b),l.Kb(n.c),l.Kb(l.h))},e.\u0275cmp=l.Eb({type:e,selectors:[["app-edit-role"]],decls:22,vars:16,consts:[[1,"d-flex","justify-content-center","cardF"],["header","Edici\xf3n de role","styleClass","p-card-shadow"],["novalidate","",1,"needs-validation","center",3,"formGroup","ngSubmit"],[1,"form-row"],[1,"col-md-12","mb-3"],[1,"input-group"],["id","roleName","name","roleName","type","text","formControlName","roleName","placeholder","Nombre del role",1,"form-control"],["class","invalid-feedback",4,"ngIf"],[1,"row","m-3"],["formGroupName","permissionId"],["class","p-field-checkbox col-md-12",4,"ngFor","ngForOf"],["type","submit","label","Guardar","icon","pi pi-check","styleClass","p-button-sm p-button-success",3,"disabled"],["label","Cancelar","icon","pi pi-times","styleClass","p-button-sm p-button-danger",3,"routerLink"],[1,"invalid-feedback"],[4,"ngIf"],[1,"p-field-checkbox","col-md-12"],["name","permissionId","binary","true",3,"formControlName","value","inputId","onChange"],[3,"for"]],template:function(e,t){1&e&&(l.Lb(0,"router-outlet"),l.Qb(1,"div",0),l.Qb(2,"p-card",1),l.Qb(3,"form",2),l.Xb("ngSubmit",function(){return t.UpdateRole()}),l.Qb(4,"div",3),l.Qb(5,"div",4),l.Qb(6,"label"),l.Fc(7,"Nombre del Role*"),l.Pb(),l.Qb(8,"div",5),l.Lb(9,"input",6),l.Dc(10,$,3,2,"div",7),l.Pb(),l.Lb(11,"br"),l.Qb(12,"div",8),l.Fc(13," Seleccione las opciones sobre las que tiene permisos "),l.Qb(14,"b"),l.Fc(15,"(al menos una)"),l.Pb(),l.Pb(),l.Pb(),l.Qb(16,"div",9),l.Dc(17,z,4,5,"div",10),l.cc(18,"keyvalue"),l.Pb(),l.Pb(),l.Lb(19,"br"),l.Lb(20,"p-button",11),l.Lb(21,"p-button",12),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.yb(3),l.hc("formGroup",t.formRoleDetailGroup),l.yb(6),l.Ab(l.lc(11,V,t.roleName.invalid&&(t.roleName.dirty||t.roleName.touched||t.roleName.errors.minlength),t.roleName.valid)),l.yb(1),l.hc("ngIf",t.roleName.invalid&&(t.roleName.dirty||t.roleName.touched)),l.yb(7),l.hc("ngForOf",l.dc(18,9,t.permissions)),l.yb(3),l.hc("disabled",!t.formRoleDetailGroup.valid),l.yb(1),l.Ac(l.jc(14,H)),l.hc("routerLink",l.jc(15,J)))},directives:[r.g,G.a,n.s,n.n,n.g,n.a,n.m,n.e,d.l,n.h,d.k,h.a,r.c,_.a],pipes:[d.f],styles:[".cardF[_ngcontent-%COMP%]{padding:5%}"]}),e})(),canActivate:[i.a]}]}];let Y=(()=>{class e{}return e.\u0275mod=l.Ib({type:e}),e.\u0275inj=l.Hb({factory:function(t){return new(t||e)},imports:[[r.f.forChild(W)],r.f]}),e})();var Z=o("7LiV"),ee=o("Gxio"),te=o("eO1q"),oe=o("+la4"),ne=o("lVkt"),re=o("yNBN"),ie=o("/RsI"),ae=o("arFO"),se=o("+DzE"),le=o("vKg+"),ce=o("xlun"),be=o("EVgl"),de=o("0LTx"),ue=o("7CaW"),me=o("Q4Mo"),pe=o("Ks7X"),he=o("LuMj"),fe=o("zFJ7"),ge=o("dPl2"),ve=o("NCSE"),ye=o("Js94"),Pe=o("1SLH");let Ce=(()=>{class e{}return e.\u0275mod=l.Ib({type:e}),e.\u0275inj=l.Hb({factory:function(t){return new(t||e)},imports:[[d.c,Y,G.b,n.i,n.p,Z.a,p.e,u.b,te.b,oe.a,ie.a,ne.a,re.a,ae.b,h.c,ee.b,f.b,se.b,le.a,ce.b,be.a,de.a,ue.a,pe.b,me.b,_.b,he.a,fe.b,ge.a,Pe.a,ve.a,ye.a]]}),e})()}}]);